---
- name: Bootstrap server
  hosts: servers
  remote_user: root
  gather_facts: true
  roles:
    - base # Install fundamental dependencies (git, ufw, fail2ban)
    - user # Set up a normal user to use the rest of the way

- name: Configure server
  hosts: servers
  remote_user: jpnance
  gather_facts: false
  roles:
    - docker # Install and configure Docker for use
    - chezmoi # Install and configure chezmoi for use
    - apps # Clone apps, install dependencies, and start Docker containers
    - nginx # Install nginx and set up virtual hosts for apps

# Install SSL certificates
- name: Install certificates
  hosts: servers
  remote_user: jpnance
  gather_facts: false
  tags: [certs, never]
  roles:
    - certs

